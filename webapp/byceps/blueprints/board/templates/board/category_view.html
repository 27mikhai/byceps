{% extends 'layout/base.html' %}
{% from 'macros/board.html' import render_flag_new %}
{% from 'macros/datetime.html' import render_datetime %}
{% from 'macros/icons.html' import render_icon %}
{% from 'macros/pagination.html' import render_pagination_nav %}
{% from 'macros/user.html' import render_user_link %}
{% set current_page = 'board' %}
{% set title = 'Forum - %s'|format(category.title) %}

{% block body %}

  <nav class="breadcrumbs">
    <ol>
      <li><a href="{{ url_for('.category_index') }}">Forum</a></li>
      <li>{{ category.title }}</li>
    </ol>
  </nav>

  <table class="index wide">
    <thead>
      <tr>
        <th>Thema</th>
        <th>begonnen von</th>
        <th class="centered">Antworten</th>
        <th>Letzter Beitrag</th>
      </tr>
    </thead>
    <tbody>
      {%- for topic in topics.items %}
      <tr id="topic-{{ topic.id }}"{% if topic.hidden %} class="dimmed"{% endif %}>
        <td>
          {%- if topic.hidden %}{{ render_icon('hidden', title='versteckt (durch %s)'|format(topic.hidden_by.screen_name)) }} {% endif -%}
          {%- if topic.locked %}{{ render_icon('lock', title='geschlossen (durch %s)'|format(topic.locked_by.screen_name)) }} {% endif -%}
          {%- if topic.pinned %}{{ render_icon('pin', title='angeheftet (durch %s)'|format(topic.pinned_by.screen_name)) }} {% endif -%}
          <a href="{{ url_for('.topic_view', id=topic.id) }}">{{ topic.title }}</a>
          {%- if topic.contains_unseen_postings() %} {{ render_flag_new() }}{% endif -%}
        </td>
        <td>{{ render_user_link(topic.creator) }}</td>
        <td class="centered">{{ topic.reply_count }}</td>
        <td class="nowrap">{{ render_datetime(topic.last_updated_at) }}<br/>von {{ render_user_link(topic.last_updated_by) }}</td>
      </tr>
      {%- endfor %}
      <tr>
    </tbody>
  </table>

{{ render_pagination_nav(topics, 'board.category_view', {'slug': category.slug}) }}

  <div style="text-align: right;">
    {%- set current_user_may_create_topic =  g.current_user.has_permission(BoardTopicPermission.create) %}
    {%- if not current_user_may_create_topic %}
    <small style="margin-right: 1em;">Du musst <a href="{{ url_for('user.login_form') }}">angemeldet</a> sein um Themen hinzufügen zu können.</small>
    {%- endif %}
    <ol class="actions">
    {%- if current_user_may_create_topic %}
      <li><a href="{{ url_for('.topic_create_form', category_id=category.id) }}">{{ render_icon('add') }} Thema hinzufügen</a></li>
    {%- else %}
      <li><span class="action disabled">{{ render_icon('add') }} Thema hinzufügen</span></li>
    {%- endif %}
    </ol>
  </div>

{%- endblock body %}
