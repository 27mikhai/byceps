{% extends 'layouts/user_admin.html' %}
{% from 'macros/datetime.html' import render_datetime %}
{% from 'macros/icons.html' import render_icon %}
{% from 'macros/misc.html' import render_tag %}
{% from 'macros/shop_order_admin.html' import render_order_link %}
{% from 'macros/user_admin.html' import render_user_avatar_20_and_link %}
{% set current_tab = 'activities' %}
{% set current_tab_user_id = user.id %}
{% set title = 'Benutzer - Aktivität - %s'|format(user.screen_name) %}

{% block head %}
    <style>
      .newsletter-subscribed {
        background-color: #11aa22;
      }
      .newsletter-unsubscribed {
        background-color: #ee3322;
      }
    </style>
{%- endblock %}

{% block body %}

{%- include 'user_admin/_view_head.html' %}

  <h2>Aktivität</h2>
  <ol class="activity-stream">
    {%- for event in events|sort(attribute='occurred_at', reverse=True) %}
      {%- with %}
        {%- if event.event == 'user-created' %}
          {%- set icon_name = 'add' %}
          {%- set body %}
            Der Benutzer ist von <span class="user-link">{{ render_user_avatar_20_and_link(event.initiator) }}</span> angelegt worden.
          {%- endset %}
        {%- elif event.event == 'user-logged-in' %}
          {%- set icon_name = 'log-in' %}
          {%- set body %}
            <span class="user-link">{{ render_user_avatar_20_and_link(user) }}</span>
            hat sich von IP-Adresse {{ event.data.ip_address }} <strong>erfolgreich angemeldet</strong>.
          {%- endset %}
        {%- elif event.event == 'avatar-updated' %}
          {%- set icon_name = 'upload' %}
          {%- set body %}
            <span class="user-link">{{ render_user_avatar_20_and_link(event.initiator) }}</span> hat ein <a href="{{ event.data.url }}">neues Avatarbild</a> hochgeladen.
          {%- endset %}
        {%- elif event.event == 'newsletter-requested' %}
          {%- set icon_name = 'email' %}
          {%- set body %}
            <span class="user-link">{{ render_user_avatar_20_and_link(event.initiator) }}</span>
            hat den Newsletter zur Marke &quot;{{ event.data.brand_id }}&quot; {{ render_tag('angefordert', icon='success', class='newsletter-subscribed') }}.
          {%- endset %}
        {%- elif event.event == 'newsletter-declined' %}
          {%- set icon_name = 'email' %}
          {%- set body %}
            <span class="user-link">{{ render_user_avatar_20_and_link(event.initiator) }}</span>
            hat den Newsletter zur Marke &quot;{{ event.data.brand_id }}&quot; {{ render_tag('abbestellt', icon='disabled', class='newsletter-unsubscribed') }}.
          {%- endset %}
        {%- elif event.event == 'order-placed' %}
          {%- set icon_name = 'shopping-cart' %}
          {%- set body %}
            <span class="user-link">{{ render_user_avatar_20_and_link(event.initiator) }}</span> hat Bestellung {{ render_order_link(event.data.order) }} aufgegeben.
          {%- endset %}
        {%- elif event.event == 'terms-consent-expressed' %}
          {%- set icon_name = 'legal' %}
          {%- set body %}
            <span class="user-link">{{ render_user_avatar_20_and_link(event.initiator) }}</span>
            hat die aktuellen <strong>AGB</strong> (&quot;{{ event.data.version_title }}&quot;) <strong>angenommen</strong>.
          {%- endset %}
        {%- else %}
          {%- set icon_name = 'disabled' %}
          {%- set body %}
            <strong>Unbekannte Aktion '{{ event.event }}'</strong> ist ausgelöst worden.
          {%- endset %}
        {%- endif %}
    <li>
      <table class="activity-stream-item">
        <tr>
          <td><span class="icon-container">{{ render_icon(icon_name) }}</span></td>
          <td>{{ body|safe }}</td>
          <td class="timestamp">{{ render_datetime(event.occurred_at) }}</td>
        </tr>
      </table>
    </li>
      {%- endwith %}
    {%- endfor %}
    {%- for activity in activities %}
    <li>
      <table class="activity-stream-item">
        <tr>
          <td><span class="icon-container">{{ render_activity_icon(activity) }}</span></td>
          <td><span class="user-link">{{ render_user_avatar_20_and_link(user) }}</span> {{ render_activity_label(activity) }}</td>
          <td class="timestamp">{{ render_datetime(activity.occured_at) }}</td>
        </tr>
      </table>
    </li>
    {%- endfor %}
  </ol>

{%- endblock %}


{% macro render_activity_icon(activity) -%}
  {%- set type_name = activity.type.name %}
  ?
{%- endmacro %}


{% macro render_activity_label(activity) -%}
  {%- set type_name = activity.type.name %}
  ?
{%- endmacro %}
