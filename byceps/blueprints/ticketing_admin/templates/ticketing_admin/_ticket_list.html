{%- from 'macros/misc.html' import render_tag %}
{%- from 'macros/user_admin.html' import render_user_avatar_16_and_link %}

<table class="index wide">
  <thead>
    <tr>
      <th>ID</th>
      <th>Besitzer</th>
      <th>Kategorie</th>
      <th>Sitzplatz</th>
      <th>Nutzer</th>
    </tr>
  </thead>
  <tbody>
    {%- for ticket in tickets|sort(attribute='created_at') %}
    <tr>
      <td>
        <a href="{{ url_for('.view_ticket', ticket_id=ticket.id) }}" title="{{ ticket.id }}">{{ ticket.id|string|truncate(6, killwords=True, end='…') }}</a>
        {%- if ticket.revoked %}<br>{{ render_tag('widerrufen', class='color-danger', title='Dieses Ticket ist nicht mehr gültig.') }}{% endif %}
      </td>
      <td>{{ render_user_avatar_16_and_link(ticket.owned_by) }}</td>
      <td>{{ ticket.category.title }}</td>
      <td>
        {%- if ticket.occupied_seat -%}
        {{ ticket.occupied_seat.area.title }}
        {%- else -%}
        {{ render_tag('keiner', class='available') }}
        {%- endif -%}
        <br>
        {{ 'verwaltet durch'|dim  }} {{ render_user_avatar_16_and_link(ticket.get_seat_manager()) }}
      </td>
      <td>
        {%- if ticket.used_by -%}
        {{ render_user_avatar_16_and_link(ticket.used_by) }}
        {%- else -%}
        {{ render_tag('frei', class='available') }}
        {%- endif -%}
        <br>
        {{ 'verwaltet durch'|dim }} {{ render_user_avatar_16_and_link(ticket.get_user_manager()) }}
      </td>
    </tr>
    {%- endfor %}
  </tbody>
</table>
