{% from 'macros/icons.html' import render_icon %}
{% from 'macros/party_admin.html' import render_party_admin_link %}


{% macro render_brand_head(brand) %}
  <div class="head-brand">
    Marken
    {{ '/'|dim }}
    <div>
      <strong><a href="{{ url_for('party_admin.index_for_brand', brand_id=brand.id) }}">{{ brand.title }}</a></strong>
    </div>
  </div>
{% endmacro %}


{% macro render_party_head(party) %}
  <div class="head-party">
    <a href="{{ url_for('party_admin.index_for_brand', brand_id=party.brand.id) }}">{{ party.brand.title }}</a>
    {{ '/'|dim }}
    <div>
      <strong>{{ render_party_admin_link(party) }}</strong>
      <div class="dropdown">
        <button style="font-size: 1rem; padding: 0;"><span class="icon-caret-down"></span></button>
        <ol>
          {%- for party in party.brand.parties|sort(attribute='starts_at', reverse=True) %}
          <li>{{ render_party_admin_link(party, dim_archived=True) }}</li>
          {%- endfor %}
        </ol>
      </div>
    </div>
  </div>
{% endmacro %}


{% macro render_navigation(navigation, current_page, css_class=None, labels=False) %}
  <nav{% if css_class %} class="{{ css_class }}"{% endif %}>
    <ol>
      {%- for item in navigation.get_items() %}
      <li{% if (item.id is not none) and (item.id is is_current_page(current_page)) %} class="current"{% endif %}><a href="{{ item.endpoint }}" title="{{ item.label }}">
        {{- render_icon(item.icon) if item.icon else item.label[0] -}}
        {%- if labels %} {{ item.label }}{% endif -%}
      </a></li>
      {%- endfor %}
    </ol>
  </nav>
{% endmacro %}


{% macro render_navigation_global(current_page, css_class=None, labels=False) -%}
  {%- set navigation = Navigation('global')
      .add_item(url_for('admin_dashboard.view_global'), 'Dashboard', id='admin_dashboard_global', required_permission=AdminDashboardPermission.view_global, icon='dashboard')
      .add_item(url_for('user_admin.index'), 'Benutzer', id='user_admin', required_permission=UserPermission.list, icon='users')
      .add_item(url_for('authorization_admin.role_index'), 'Berechtigungen', id='authorization_admin.roles', required_permission=RolePermission.list, icon='permission')
      .add_item(url_for('orga_admin.birthdays'), 'Geburtstage', id='orga_admin.birthdays', required_permission=OrgaBirthdayPermission.list, icon='birthday')
  -%}
{{ render_navigation(navigation, current_page, css_class=css_class, labels=labels) }}
{% endmacro %}


{% macro render_navigation_brand(current_page, css_class=None, labels=False) -%}
  {%- set navigation = Navigation('Marke')
      .add_item(url_for('admin_dashboard.view_brand', brand_id=brand.id), 'Dashboard', id='admin_dashboard_brand', required_permission=AdminDashboardPermission.view_brand, icon='dashboard')
      .add_item(url_for('news_admin.index_for_brand', brand_id=brand.id), 'News', id='news_admin', required_permission=NewsItemPermission.list, icon='news')
      .add_item(url_for('newsletter_admin.view_subscriptions', brand_id=brand.id), 'Newsletter', id='newsletter_admin', required_permission=NewsletterPermission.view_subscriptions, icon='newsletter')
      .add_item(url_for('terms_admin.index_for_brand', brand_id=brand.id), 'AGB', id='terms_admin', required_permission=TermsPermission.list, icon='legal')
      .add_item(url_for('board_admin.index_for_brand', brand_id=brand.id), 'Board', id='board_admin', required_permission=BoardCategoryPermission.list, icon='board')
  -%}
{{ render_navigation(navigation, current_page, css_class=css_class, labels=labels) }}
{% endmacro %}


{% macro render_navigation_party(current_page, css_class=None, labels=False) -%}
  {%- set navigation = Navigation('Party')
      .add_item(url_for('admin_dashboard.view_party', party_id=party.id), 'Dashboard', id='admin_dashboard_party', required_permission=AdminDashboardPermission.view_party, icon='dashboard')
      .add_item(url_for('snippet_admin.index_for_party', party_id=party.id), 'Snippets', id='snippet_admin', required_permission=SnippetPermission.list, icon='snippet')
      .add_item(url_for('seating_admin.index_for_party', party_id=party.id), 'Sitzpl√§ne', id='seating_admin', required_permission=SeatingPermission.view, icon='seating-area')
      .add_item(url_for('shop_admin.article_index_for_party', party_id=party.id), 'Shop-Artikel', id='shop_admin.articles', required_permission=ShopArticlePermission.list, icon='shopping-cart')
      .add_item(url_for('shop_admin.order_index_for_party', party_id=party.id), 'Shop-Bestellungen', id='shop_admin.orders', required_permission=ShopOrderPermission.list, icon='payment')
      .add_item(url_for('ticket_admin.index_for_party', party_id=party.id), 'Tickets', id='ticket_admin', required_permission=TicketPermission.list, icon='ticket')
      .add_item(url_for('orga_admin.teams_for_party', party_id=party.id), 'Orga-Teams', id='orga_admin.teams', required_permission=OrgaTeamPermission.list, icon='users')
      .add_item(url_for('orga_presence.view', party_id=party.id), 'Orga-Anwesenheit', id='orga_presence', required_permission=OrgaPresencePermission.list, icon='date-okay')
  -%}
{{ render_navigation(navigation, current_page, css_class=css_class, labels=labels) }}
{% endmacro %}


{% macro render_main_tabs(navigation, current_page) -%}
  <ol class="main-tabs">
    {%- for item in navigation.get_items() %}
      {%- with is_current = (item.id is not none) and (item.id is is_current_page(current_page)) %}
        <li>
          {%- if is_current %}<span class="current">{% else %}<a href="{{ item.endpoint }}">{% endif -%}
          {% if item.icon %}{{ render_icon(item.icon) }}{% endif %} {{ item.label }}
          {%- if is_current %}</span>{% else %}</a>{% endif -%}
        </li>
      {%- endwith %}
    {%- endfor %}
  </ol>
{%- endmacro %}


{% macro render_extra_in_heading(value) -%}
  <small>{{ value }}</small>
{%- endmacro %}
