{% extends 'layouts/admin/shop.html' %}
{% from 'macros/misc.html' import render_notification %}
{% set current_page_shop = shop %}
{% set current_page = 'shop_email_admin' %}
{% set current_tab = 'email' %}
{% set title = 'E-Mail' %}

{% block head %}
<style>
  .email-example summary:focus {
    outline: none;
  }

  .email-example summary:hover {
    cursor: pointer;
    text-decoration: underline;
  }

  .email-example code {
    background-color: #eeeeee;
    display: block;
    font-size: 0.75rem;
    max-width: 46rem;
    overflow-x: scroll;
    padding: 1rem;
  }
</style>
{%- endblock %}

{% block body %}

  <nav class="breadcrumbs">
    <ol>
      <li><a href="{{ url_for('shop_shop_admin.index') }}">Shops</a></li>
      <li><a href="{{ url_for('shop_shop_admin.view', shop_id=shop.id) }}">{{ shop.title }}</a></li>
    </ol>
  </nav>
  <h1>E-Mail</h1>

  <h2>Beispiele</h2>

  <details class="email-example">
    <summary>Bestellbest√§tigung</summary>
    {{ render_message_text(placed_order_message_text) }}
  </details>

  <details class="email-example">
    <summary>Zahlungseingang</summary>
    {{ render_message_text(paid_order_message_text) }}
  </details>

  <details class="email-example">
    <summary>Stornierung</summary>
    {{ render_message_text(canceled_order_message_text) }}
  </details>

  <h2>Konfiguration</h2>
  <table class="index">
    <tr>
      <th>Konfigurations-ID</th>
      <td class="monospace">{{ email_config.id }}</td>
    </tr>
    <tr>
      <th>Absender-Adresse</th>
      <td>{{ email_config.sender.address }}</td>
    </tr>
    <tr>
      <th>Absender-Name</th>
      <td>{{ email_config.sender.name|fallback }}</td>
    </tr>
    <tr>
      <th>Kontaktadresse</th>
      <td>{{ email_config.contact_address|fallback }}</td>
    </tr>
  </table>

{%- endblock %}

{% macro render_message_text(message_text) -%}
  {%- if message_text -%}
    <pre><code>{{ message_text }}</code></pre>
  {%- else -%}
    {{ render_notification('Could not assemble example email. Are all necessary templates defined?', category='danger') }}
  {%- endif -%}
{%- endmacro %}
