{%- from 'macros/admin/log.html' import render_log_entry, render_log_user %}
{%- from 'macros/admin/shop/order.html' import render_order_payment_state %}
{%- from 'macros/admin/ticketing.html' import render_ticket_flag_revoked %}


  <div class="events">
    {%- for log_entry in log_entries|sort(attribute='occurred_at', reverse=True) %}
      {%- if log_entry.event_type == 'order-placed' %}
        {%- call render_log_entry('add', log_entry.occurred_at) %}
          {{ render_log_user(log_entry.initiator) }}
          hat die Bestellung <strong>aufgegeben</strong>.
        {%- endcall %}
      {%- elif log_entry.event_type == 'order-canceled-before-paid' %}
        {%- call render_log_entry('disabled', log_entry.occurred_at) %}
          {{ render_log_user(log_entry.initiator) }}
          hat die Bestellung {{ render_order_payment_state(PaymentState.canceled_before_paid) }}
          (war vorher {{ render_order_payment_state(PaymentState[log_entry.data.former_payment_state]) }}).
          <br><br>
          {{ _('Reason') }}:<br>
          <blockquote>{{ log_entry.data.reason }}</blockquote>
        {%- endcall %}
      {%- elif log_entry.event_type == 'order-paid' %}
        {%- call render_log_entry('success', log_entry.occurred_at) %}
          {{ render_log_user(log_entry.initiator) }}
          hat die Bestellung als {{ render_order_payment_state(PaymentState.paid) }}
          mittels {{ render_order_payment_method(log_entry.data.payment_method) }} markiert.
        {%- endcall %}
      {%- elif log_entry.event_type == 'order-canceled-after-paid' %}
        {%- call render_log_entry('disabled', log_entry.occurred_at) %}
          {{ render_log_user(log_entry.initiator) }}
          hat die Bestellung {{ render_order_payment_state(PaymentState.canceled_after_paid) }}
          (war vorher {{ render_order_payment_state(PaymentState[log_entry.data.former_payment_state]) }}).
          <br><br>
          {{ _('Reason') }}:<br>
          <blockquote>{{ log_entry.data.reason }}</blockquote>
        {%- endcall %}
      {%- elif log_entry.event_type == 'order-invoiced' %}
        {%- call render_log_entry('invoice', log_entry.occurred_at) %}
          {{ render_log_user(log_entry.initiator) }}
          hat die Rechnung als <strong>erstellt</strong> markiert.
        {%- endcall %}
      {%- elif log_entry.event_type == 'order-invoiced-withdrawn' %}
        {%- call render_log_entry('remove', log_entry.occurred_at) %}
          {{ render_log_user(log_entry.initiator) }}
          hat die Rechnung als <strong>doch nicht erstellt</strong> markiert.
        {%- endcall %}
      {%- elif log_entry.event_type == 'order-note-added' %}
        {%- call render_log_entry('note', log_entry.occurred_at) %}
          {{ render_log_user(log_entry.author) }}
          hat eine Notiz hinzugefügt:<br>
          <blockquote>{{ log_entry.data.text }}</blockquote>
        {%- endcall %}
      {%- elif log_entry.event_type == 'order-shipped' %}
        {%- call render_log_entry('shipping', log_entry.occurred_at) %}
          {{ render_log_user(log_entry.initiator) }}
          hat die Lieferung als <strong>versendet</strong> markiert.
        {%- endcall %}
      {%- elif log_entry.event_type == 'order-shipped-withdrawn' %}
        {%- call render_log_entry('remove', log_entry.occurred_at) %}
          {{ render_log_user(log_entry.initiator) }}
          hat die Lieferung als <strong>doch nicht versendet</strong> markiert.
        {%- endcall %}
      {%- elif log_entry.event_type == 'order-placed-confirmation-email-resent' %}
        {%- call render_log_entry('email', log_entry.occurred_at) %}
          {{ render_log_user(log_entry.initiator) }}
          hat den Versand der Bestellbestätigung per E-Mail <strong>erneut ausgelöst</strong>.
        {%- endcall %}
      {%- elif log_entry.event_type == 'badge-awarded' %}
        {%- call render_log_entry('badge', log_entry.occurred_at) %}
          Das <strong>Badge &quot;{{ log_entry.badge_label }}&quot;</strong> ist an
          {{ render_log_user(log_entry.recipient) }}
          verliehen worden.
        {%- endcall %}
      {%- elif log_entry.event_type == 'ticket-bundle-created' %}
        {%- call render_log_entry('ticket', log_entry.occurred_at) %}
          Ein <strong><a href="{{ url_for('ticketing_admin.view_bundle', bundle_id=log_entry.bundle_id) }}">Ticketpaket</a></strong> mit {{ log_entry.ticket_quantity }} Tickets der Kategorie &quot;{{ log_entry.ticket_category_title|fallback('unbekannt') }}&quot; ist erzeugt worden.
        {%- endcall %}
      {%- elif log_entry.event_type == 'ticket-bundle-revoked' %}
        {%- call render_log_entry('ticket', log_entry.occurred_at) %}
          {%- if log_entry.initiator is defined %}
          {{ render_log_user(log_entry.initiator) }}
          {%- else %}
          Jemand
          {%- endif %}
          hat das <strong><a href="{{ url_for('ticketing_admin.view_bundle', bundle_id=log_entry.bundle_id) }}">Ticketpaket</a></strong> {{ render_ticket_flag_revoked() }}.
        {%- endcall %}
      {%- elif log_entry.event_type == 'ticket-created' %}
        {%- call render_log_entry('ticket', log_entry.occurred_at) %}
          Das <strong><a href="{{ url_for('ticketing_admin.view_ticket', ticket_id=log_entry.ticket_id) }}">Ticket {{ log_entry.ticket_code }}</a></strong> ist erzeugt worden.
        {%- endcall %}
      {%- elif log_entry.event_type == 'ticket-revoked' %}
        {%- call render_log_entry('ticket', log_entry.occurred_at) %}
          {%- if log_entry.initiator is defined %}
          {{ render_log_user(log_entry.initiator) }}
          {%- else %}
          Jemand
          {%- endif %}
          hat das <strong>Ticket {{ log_entry.ticket_code }}</strong> {{ render_ticket_flag_revoked() }}.
        {%- endcall %}
      {%- else %}
        {%- call render_log_entry('disabled', log_entry.occurred_at) %}
          {{ render_log_user(log_entry.initiator) }}
          hat die <strong>unbekannte Aktion '{{ log_entry.event_type }}'</strong> ausgelöst.
        {%- endcall %}
      {%- endif %}
    {%- endfor %}
  </div>
