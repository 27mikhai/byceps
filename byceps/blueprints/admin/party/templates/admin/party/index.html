{% extends 'layout/admin/base.html' %}
{% from 'macros/admin.html' import render_extra_in_heading %}
{% from 'macros/admin/brand.html' import render_brand_avatar %}
{% from 'macros/datetime.html' import render_datetime %}
{% from 'macros/misc.html' import render_tag %}
{% set current_page = 'partys_admin' %}
{% set title = 'Partys' %}
{% set layout_main_raw = True %}

{% block body %}

  <div class="row row--space-between">
    <div class="column-auto">
      <h1>{{ title }} {{ render_extra_in_heading(parties|length) }}</h1>
    </div>
    {%- if g.current_user.has_permission(PartyPermission.create) %}
    <div class="column-auto">
      <div class="button-row button-row--right">
        <div class="dropdown left">
          <button class="dropdown-toggle button"><span>{{ render_icon('add') }} Party erstellen</span></button>
          <ol>
            <li><span><strong>Marke:</strong></span></li>
            <li class="divider"></li>
          {%- for brand in brands %}
            <li><a href="{{ url_for('.create_form', brand_id=brand.id) }}"><span style="margin-right: 0.25rem;">{{ render_brand_avatar(brand, '24') }}</span> {{ brand.title }}</a></li>
          {%- endfor %}
          </ol>
        </div>
      </div>
    </div>
    {%- endif %}
  </div>

  {%- if parties %}
    {%- for party in parties|sort(attribute='starts_at', reverse=True) %}
  <div class="box" style="border-left: {{ '#55cc00' if not party.archived else '#aaaaaa' }} solid 0.25rem; margin-bottom: 1rem;">
    <div class="row row--space-between">

      <div class="column-auto" style="min-width: 35%;">
        <div class="row">
          <div class="column-auto">
            <div style="margin-right: -0.25rem;">{{ render_brand_avatar(party.brand, '40') }}</div>
          </div>
          <div class="column-auto">
            <a href="{{ url_for('.view', party_id=party.id) }}" class="disguised" style="display: block;">
              <strong>{{ party.title }}</strong><br>
              <span class="monospace">{{ party.id }}</span>
            </a>
          </div>
        </div>
      </div>

      <div class="column-auto" style="min-width: 30%;">
        <div>
          {{- render_datetime(party.starts_at|utc_to_local_tz) }} bis<br>
          {{- render_datetime(party.ends_at|utc_to_local_tz) -}}
          {%- if party.is_over %}
          {{ render_tag('vorbei', class='color-disabled') }}
          {%- endif %}
          <br>
        {%- for day in days_by_party_id[party.id] %}
          {{ render_tag('{:%a}'.format(day)) }}
        {%- endfor %}
        </div>
      </div>

      <div class="column-auto" style="text-align: right;">
        Ticket&shy;verwaltung: {{ render_tag('geöffnet', class='color-success') if party.ticket_management_enabled else render_tag('gesperrt', class='color-disabled', icon='disabled') }}
        <br>
        Sitzplatz&shy;verwaltung: {{ render_tag('geöffnet', class='color-success') if party.seat_management_enabled else render_tag('gesperrt', class='color-disabled', icon='disabled') }}
        <br>
        <br>
        {%- if party.archived %}
        {{ render_tag('archiviert', class='color-disabled', icon='archived') }}
        {%- endif %}
      </div>

    </div>{# .row #}
  </div>{# .box #}
    {%- endfor %}
  {%- else %}
  <div class="dimmed-box centered">Es sind keine Partys hinterlegt.</div>
  {%- endif %}

{%- endblock %}
