{% from 'macros/admin/brand.html' import render_brand_avatar %}
{% from 'macros/admin/dashboard.html' import render_cell %}
{% from 'macros/datetime.html' import render_date %}
{% from 'macros/misc.html' import render_tag %}


<div class="row row--space-between">
  <div class="column-auto">
    <div class="dashboard-section-title">{{ _('Active Parties') }}</div>
  </div>
  <div class="column-auto">
    <a class="dashboard-section-link" href="{{ url_for('party_admin.index_for_brand', brand_id=brand.id) if brand|default else url_for('party_admin.index') }}">{{ _('All parties') }} &rarr;</a>
  </div>
</div>

<div class="grid">

{%- if active_parties_with_ticket_stats %}
  {%- for party, ticket_sale_stats in active_parties_with_ticket_stats %}
    {%- call render_cell(href=url_for('admin_dashboard.view_party', party_id=party.id)) %}
  <div class="row">
    <div class="column-auto">
      {{ render_brand_avatar(party.brand, '40') }}
    </div>
    <div class="column-auto column-auto--grow">
      <div>{{ party.title }}</div>
      <div class="supplement">{{ render_date(party.starts_at, smart=False) }}â€“{{ render_date(party.ends_at, smart=False) }}</div>
    </div>
  </div>

      {%- with tickets_total_max_specified = (ticket_sale_stats.tickets_max is not none) %}
  <div class="progress" style="height: 0.25rem; margin-top: 1rem;">
        {%- if tickets_total_max_specified %}
    <div class="progress-bar color-success" style="width: calc(100% * {{ ticket_sale_stats.tickets_sold }} / {{ ticket_sale_stats.tickets_max }});"></div>
        {%- endif %}
  </div>
  <div style="color: #999999; font-size: 0.6875rem; text-align: right;">
    <strong>{{ format_number(ticket_sale_stats.tickets_sold) }}</strong>
    {{ _('of') }}
    <strong>{{ format_number(ticket_sale_stats.tickets_max) if tickets_total_max_specified else '?' }}</strong>
    {{ _('tickets sold') }}
        {%- if tickets_total_max_specified and ticket_sale_stats.tickets_sold >= ticket_sale_stats.tickets_max %}
    <div class="centered">{{ render_tag(_('sold out')) }}</div>
        {%- endif %}
  </div>
      {%- endwith %}

    {%- endcall %}
  {%- endfor %}
{%- else %}
  {%- call render_cell() %}
  <div style="display: grid; height: 100%; place-items: center;">{{ _('No active parties')|dim }}</div>
  {%- endcall %}
{%- endif %}

</div>
