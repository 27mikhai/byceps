{% extends 'layout/admin/base.html' %}
{% from 'macros/admin/brand.html' import render_brand_admin_link %}
{% from 'macros/admin.html' import render_extra_in_heading %}
{% from 'macros/icons.html' import render_icon %}
{% from 'macros/misc.html' import render_tag %}
{% set current_page = 'site_admin' %}
{% set current_page_site = site %}
{% set page_title = [site.id, _('Site')] %}
{% set layout_main_raw = True %}

{% block body %}

  <div class="row row--space-between">
    <div class="column-auto">

      <nav class="breadcrumbs">
        <ol>
          <li><a href="{{ url_for('site_admin.index') }}">{{ _('Sites') }}</a></li>
        </ol>
      </nav>
      <h1>
        {{- site.title }}
        {%- if not site.enabled or site.archived -%}
        <br>
          {%- if not site.enabled %}
        {{ render_tag(_('disabled'), class='color-disabled', icon='disabled') }}
          {%- endif %}
          {%- if site.archived %}
        {{ render_tag(_('archived'), class='color-disabled', icon='archived') }}
          {%- endif %}
        {%- endif -%}
      </h1>

    </div>
    <div class="column-auto column--align-bottom">

      {%- if has_current_user_permission(SitePermission.update) %}
      <div class="button-row button-row--right">
        <a class="button" href="{{ url_for('.update_form', site_id=site.id) }}">{{ render_icon('edit') }} <span>{{ _('Edit') }}</span></a>
      </div>
      {%- endif %}

    </div>
  </div>

  <div class="box">
    <table class="index">
      <tr>
        <th>ID</th>
        <td>{{ site.id }}</td>
      </tr>
      <tr>
        <th>{{ _('Server name') }}</th>
        <td><a href="https://{{ site.server_name }}/" class="disguised">{{ site.server_name }}</a></td>
      </tr>
      <tr>
        <th>{{ _('Brand') }}</th>
        <td>{{ render_brand_admin_link(brand) }}</td>
      </tr>
      <tr>
        <th>{{ _('Party') }}</th>
        <td>{% if site.party_id %}<a href="{{ url_for('admin_dashboard.view_party', party_id=site.party_id) }}">{{ site.party_id }}</a>{% else %}{{ ''|fallback }}{% endif %}</td>
      </tr>
      <tr>
        <th>Benutzer&shy;registrierung</th>
        <td>{{ render_tag('geöffnet', class='color-success') if site.user_account_creation_enabled else render_tag('gesperrt', class='color-disabled', icon='disabled') }}</td>
      </tr>
      <tr>
        <th>Benutzer&shy;anmeldung</th>
        <td>{{ render_tag('geöffnet', class='color-success') if site.login_enabled else render_tag('gesperrt', class='color-disabled', icon='disabled') }}</td>
      </tr>
      <tr>
        <th>{{ _('Board') }}</th>
        <td>
          {%- if board %}
          <a href="{{ url_for('board_admin.board_view', board_id=board.id) }}">{{ board.id }}</a>
          {%- else %}
          {{ 'kein Forum verknüpft'|dim }}
          {%- endif %}
        </td>
      </tr>
      <tr>
        <th>{{ _('Storefront') }}</th>
        <td>
          {%- if storefront %}
          <a href="{{ url_for('shop_storefront_admin.view', storefront_id=storefront.id) }}">{{ storefront.id }}</a>
          {%- else %}
          {{ 'kein Storefront verknüpft'|dim }}
          {%- endif %}
        </td>
      </tr>
    </table>
  </div>

  <div class="row row--space-between">
    <div class="column-auto">
      <h2>{{ _('News Channels') }} {{ render_extra_in_heading(news_channels|length) }}</h2>
    </div>
  {%- if has_current_user_permission(SitePermission.update) %}
    <div class="column-auto column--align-bottom">
      <div class="button-row button-row--right">
        <a class="button button--compact" href="{{ url_for('.add_news_channel_form', site_id=site.id) }}">{{ render_icon('add') }} <span>{{ _('Add news channel') }}</span></a>
      </div>
    </div>
  {%- endif %}
  </div>
  <div class="box">
    {%- if news_channels %}
    <table class="index">
      <tbody>
      {%- for channel in news_channels|sort(attribute='id') %}
        <tr>
          <td><a href="{{ url_for('news_admin.channel_view', channel_id=channel.id) }}">{{ channel.id }}</a></td>
          {%- if has_current_user_permission(SitePermission.update) %}
          <td>
            <div class="button-row button-row--compact button-row--right">
              <a href="{{ url_for('.remove_news_channel', site_id=site.id, news_channel_id=channel.id) }}" data-action="news-channel-remove" class="button button--compact" title="{{ _('Remove') }}">{{ render_icon('remove') }}</a>
            </div>
          </td>
          {%- endif %}
        </tr>
      {%- endfor %}
      </tbody>
    </table>
    {%- else %}
    <div class="dimmed-box centered">{{ _('No news channels are assigned to this site.') }}</div>
    {%- endif %}
  </div>

  <h2>Einstellungen {{ render_extra_in_heading(settings|length) }}</h2>
  <div class="box">
    {%- if settings %}
    <table class="index">
      <thead>
        <tr>
          <th>Name</th>
          <th>Wert</th>
        </tr>
      </thead>
      <tbody>
      {%- for setting in settings|sort(attribute='name') %}
        <tr>
          <td class="monospace">{{ setting.name }}</td>
          <td class="monospace">{{ setting.value }}</td>
        </tr>
      {%- endfor %}
      </tbody>
    </table>
    {%- else %}
    <div class="dimmed-box centered">Es sind keine Einstellungen hinterlegt.</div>
    {%- endif %}
  </div>

{%- endblock %}

{% block scripts %}
  <script>
    onDomReady(() => {
      confirmed_delete_on_click_then_reload('[data-action="news-channel-remove"]', '{{ _('Remove news channel from site?') }}');
    });
  </script>
{%- endblock %}
